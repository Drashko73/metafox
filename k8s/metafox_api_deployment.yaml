# filepath: /home/drashko/CERAMO/metafox/k8s/metafox_api_deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: metafox-api
spec:
  replicas: 1
  selector:
    matchLabels:
      app: metafox-api
  template:
    metadata:
      labels:
        app: metafox-api
    spec:
      containers:
      - name: metafox-api
        image: drashkko/metafox-api:v2.1.0
        ports:
        - containerPort: 8000
        env:
        - name: BROKER_URL
          value: "pyamqp://rabbitmq:5672//"
        - name: RESULT_BACKEND
          value: "mongodb://mongo:27017/"
        - name: WORKER_CONCURRENCY
          value: "1"
        - name: KEYCLOAK_SERVER_URL
          value: ""
        - name: KEYCLOAK_CLIENT_ID
          value: ""
        - name: KEYCLOAK_REALM_NAME
          value: ""
        - name: KEYCLOAK_CLIENT_SECRET
          value: ""
        - name: KEYCLOAK_AUTHORIZATION_URL
          value: ""
        - name: KEYCLOAK_TOKEN_URL
          value: ""
        - name: KEYCLOAK_REFRESH_URL
          value: ""
        - name: CORS_ORIGINS
          value: ""
        - name: API_AUTH_ENABLED
          value: "False"
        - name: API_ORIGINS
          value: "*"
        - name: API_ALLOW_CREDENTIALS
          value: "True"
        - name: API_ALLOW_METHODS
          value: "*"
        - name: API_ALLOW_HEADERS
          value: "*"
        - name: MONGO_DB
          value: "metafox"
        - name: MONGO_URI
          value: "mongodb://mongo:27017/"
        - name: MONGO_COLLECTION_TASK_META
          value: "task_meta"
        - name: MONGO_COLLECTION_AUTOML_JOB_DETAILS
          value: "automl_job_details"
        - name: MONGO_COLLECTION_TASK_INFO
          value: "task_info"
        - name: REDIS_HOST
          value: "redis"
        - name: REDIS_PORT
          value: "6379"
        - name: REDIS_DB
          value: "0"
        - name: DB_TYPE
          value: "redis"
        - name: PYTHONPATH
          value: "/usr/src"
        volumeMounts:
        - name: metafox-shared
          mountPath: /usr/src/metafox_shared
      volumes:
      - name: metafox-shared
        hostPath:
          path: /mnt/metafox_shared
          type: Directory